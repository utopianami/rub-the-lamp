# tmux + Agent Team 가이드

터미널 멀티플렉서 tmux를 활용해 여러 Claude 에이전트를 **물리적으로 병렬 실행**하는 방법입니다.

---

## 왜 tmux인가?

| 문제 | tmux 해결 |
|------|----------|
| 터미널 하나에 에이전트 하나 | 패널 분할로 여러 에이전트 동시 실행 |
| SSH 끊기면 작업 중단 | 세션이 백그라운드에서 유지 |
| 어떤 에이전트가 뭘 하는지 모름 | 패널별 역할이 눈에 보임 |

---

## tmux 세팅

### .tmux.conf (Gruvbox Dark 테마)

`~/.tmux.conf`에 복사하세요:

```bash
# --- Gruvbox Dark 팔레트 ---
# bg0: #282828  bg1: #3c3836  bg2: #504945  bg3: #665c54
# fg0: #fbf1c7  fg1: #ebdbb2  fg2: #d5c4a1  fg3: #bdae93  fg4: #a89984
# red: #cc241d  green: #98971a  yellow: #d79921
# blue: #458588  purple: #b16286  aqua: #689d6a  orange: #d65d0e

# --- 패널 구분선 ---
set -g pane-border-style "fg=#504945"
set -g pane-active-border-style "fg=#d65d0e"

# --- 활성/비활성 패널 대비 ---
# 활성: 터미널 기본 gruvbox 배경 유지
# 비활성: bg1(#3c3836) + 흐린 텍스트로 확실한 차이
set -g window-style "fg=#a89984,bg=#3c3836"
set -g window-active-style "fg=#ebdbb2,bg=#282828"

# --- 상태바 ---
set -g status-position bottom
set -g status-style "bg=#282828,fg=#a89984"
set -g status-left "#[bg=#d65d0e,fg=#282828,bold] #S #[bg=#282828] "
set -g status-left-length 30

# --- 윈도우 탭 ---
set -g window-status-format "#[fg=#665c54] #I:#W "
set -g window-status-current-format "#[bg=#d79921,fg=#282828,bold] #I:#W "

# --- 기본 설정 ---
set -g mouse on
set -g base-index 1
set -g pane-base-index 1
set -g default-terminal "tmux-256color"

# --- 상태바 우측: 단축키 가이드 + 시간 ---
set -g status-right "#[fg=#665c54]─:#[fg=#a89984]\"  #[fg=#665c54]│:#[fg=#a89984]%  #[fg=#665c54]이동:#[fg=#a89984]←↑↓→  #[fg=#665c54]확대:#[fg=#a89984]z  #[fg=#665c54]패널닫기:#[fg=#a89984]x  #[fg=#665c54]탭:#[fg=#a89984]c/n/p  #[fg=#665c54]이름:#[fg=#a89984],  #[fg=#665c54]목록:#[fg=#a89984]w  #[fg=#665c54]탭닫기:#[fg=#a89984]&  #[fg=#665c54]분리:#[fg=#a89984]!  #[fg=#665c54]교체:#[fg=#a89984]{/}  #[fg=#665c54]탈출:#[fg=#a89984]q  #[fg=#d65d0e]%H:%M "
set -g status-right-length 150
```

설정 적용:
```bash
tmux source-file ~/.tmux.conf
```

---

## 기본 키바인드

모든 키바인드는 **prefix(`Ctrl+b`)를 먼저 누른 뒤** 해당 키를 누릅니다.

### 세션

| 키 | 동작 |
|----|------|
| `tmux new -s dev` | 새 세션 생성 (터미널에서) |
| `tmux attach -t dev` | 기존 세션 복귀 (터미널에서) |
| `Ctrl+b` → `d` | 세션에서 분리 (detach) |

### 패널

| 키 | 동작 |
|----|------|
| `Ctrl+b` → `%` | 수직 분할 (좌/우) |
| `Ctrl+b` → `"` | 수평 분할 (상/하) |
| `Ctrl+b` → `o` | 다음 패널로 이동 |
| `Ctrl+b` → 방향키 | 방향키 쪽 패널로 이동 |
| 마우스 클릭 | 해당 패널 선택 (mouse on 설정 시) |
| `Ctrl+b` → `x` | 현재 패널 닫기 |
| `Ctrl+b` → `z` | 현재 패널 풀스크린 토글 |

### 윈도우

| 키 | 동작 |
|----|------|
| `Ctrl+b` → `c` | 새 윈도우 생성 |
| `Ctrl+b` → `w` | 윈도우 목록 (선택 가능) |
| `Ctrl+b` → `n` / `p` | 다음/이전 윈도우 |

---

## 패널 레이아웃

### 4분할 레이아웃 (에이전트 병렬 실행)

```
┌──────────────────┬──────────────────┐
│                  │                  │
│   Agent A        │   Agent B        │
│   (executor)     │   (executor)     │
│                  │                  │
├──────────────────┼──────────────────┤
│                  │                  │
│   Agent C        │   Reviewer       │
│   (executor)     │   (reviewer)     │
│                  │                  │
└──────────────────┴──────────────────┘
```

만드는 법:
```bash
tmux new-session -s dev
# Ctrl+b → " (수평 분할)
# 상단 패널 선택 후 Ctrl+b → % (수직 분할)
# 하단 패널 선택 후 Ctrl+b → % (수직 분할)
```

### 3분할 레이아웃 (구현 + 리뷰 + 테스트)

```
┌──────────────────┬──────────────────┐
│                  │                  │
│   Executor       │   Reviewer       │
│   (구현)          │   (리뷰)         │
│                  │                  │
├──────────────────┴──────────────────┤
│                                     │
│   Tester (테스트 실행)               │
│                                     │
└─────────────────────────────────────┘
```

---

## 에이전트 팀 구성

### 역할 분배

| 역할 | 하는 일 | 실행 방식 |
|------|--------|----------|
| **Executor** (구현) | 코드 작성, 기능 구현 | 각 패널에서 `claude` 실행 후 구현 태스크 지시 |
| **Reviewer** (리뷰) | 구현된 코드 리뷰 | executor 완료 후 리뷰 요청 |
| **Tester** (테스트) | 테스트 실행 및 검증 | 리뷰 통과 후 테스트 실행 |

### 태스크 분배 원칙

1. **독립성**: 각 executor에게 서로 의존하지 않는 태스크 배정
2. **경계 명확**: 파일/모듈 단위로 분리하여 충돌 방지
3. **순차 검증**: 구현 완료 → reviewer → tester 순서

---

## 병렬 실행 패턴

### 패턴 1: 독립 모듈 동시 구현

```
┌─────────────────────────────────────────────────┐
│  Step 1: 태스크 분배 (독립 모듈 식별)              │
│                                                   │
│  Task A: config 모듈    (파일: src/config.py)      │
│  Task B: registry 모듈  (파일: src/registry.py)    │
│  Task C: metrics 모듈   (파일: src/metrics.py)     │
└─────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────┐
│  Step 2: 병렬 실행 (tmux 3개 패널)                │
│                                                   │
│  패널 1: "config 모듈 구현해줘"                    │
│  패널 2: "registry 모듈 구현해줘"        ← 동시!   │
│  패널 3: "metrics 모듈 구현해줘"                   │
└─────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────┐
│  Step 3: 리뷰 (패널 4)                            │
│                                                   │
│  "구현된 config, registry, metrics 리뷰해줘"       │
└─────────────────────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────┐
│  Step 4: 테스트                                   │
│                                                   │
│  "전체 테스트 실행해줘"                             │
└─────────────────────────────────────────────────┘
```

### 패턴 2: 기능 + 테스트 동시 작성

```
패널 1: "로그인 기능 구현해줘"
패널 2: "로그인 기능 테스트 코드 작성해줘"  ← 동시!
```

구현과 테스트를 독립적으로 작성 → 이후 통합 검증

### 패턴 3: 구현 + 문서화 동시

```
패널 1: "API 엔드포인트 구현해줘"
패널 2: "API 문서 작성해줘"  ← 동시!
```

---

## 실전 예시: jax_crackshot config/registry/metrics 병렬 구현

실제 프로젝트에서 사용한 사례입니다.

### 상황
- 3개의 독립 모듈(config, registry, metrics)을 동시에 구현해야 함
- 각 모듈은 서로 의존하지 않아 병렬 구현 가능

### 실행

```bash
# 1. tmux 세션 생성
tmux new-session -s crackshot

# 2. 4분할 레이아웃 구성
# Ctrl+b → " → 상단 Ctrl+b → % → 하단 Ctrl+b → %

# 3. 각 패널에서 claude 실행
# 패널 1 (좌상):
claude
> "config 모듈 구현해줘: JAX 학습 설정 관리"

# 패널 2 (우상):
claude
> "registry 모듈 구현해줘: 모델/옵티마이저 등록 시스템"

# 패널 3 (좌하):
claude
> "metrics 모듈 구현해줘: 학습 메트릭 수집/로깅"

# 패널 4 (우하): 리뷰어 대기
claude
> (3개 완료 후) "구현된 config, registry, metrics 코드 리뷰해줘"
```

### 결과
- 3개 모듈이 **동시에** 구현됨
- 순차 실행 대비 시간 절약
- reviewer가 전체 코드를 보면서 일관성 확인

---

## 팁

### 세션 복귀
터미널을 닫아도 tmux 세션은 살아 있습니다:
```bash
tmux attach -t dev     # 이름으로 복귀
tmux attach            # 마지막 세션으로 복귀
tmux ls                # 세션 목록 확인
```

### 패널 풀스크린
특정 패널을 크게 보고 싶을 때:
- `Ctrl+b` → `z` : 현재 패널 풀스크린 토글
- 다시 `Ctrl+b` → `z` : 원래 레이아웃으로 복귀

### 스크롤
패널 내에서 위로 스크롤:
- 마우스 스크롤 (mouse on 설정 시)
- `Ctrl+b` → `[` : 스크롤 모드 진입, `q`로 종료

### 패널 크기 조절
- `Ctrl+b` → `Ctrl+방향키` : 현재 패널 크기 조절

### 세션이 필요 없을 때
```bash
tmux kill-session -t dev    # 특정 세션 종료
tmux kill-server            # 모든 세션 종료
```
